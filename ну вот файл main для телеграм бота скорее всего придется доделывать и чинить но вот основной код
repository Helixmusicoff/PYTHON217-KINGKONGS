"""
IQ-—Ç–µ—Å—Ç –¥–ª—è Telegram –±–æ—Ç–∞ –≤–æ—Ç
–ö–æ–º–∞–Ω–¥—ã:
/start - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
/iqtest - –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç
"""

import asyncio
from pyrogram import Client, filters
from pyrogram.types import Message

# ------------------------- –ù–ê–°–¢–†–û–ô–ö–ò -------------------------
API_ID = 123456          # –í–∞—à API ID (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ my.telegram.org)
API_HASH = "your_api_hash"   # –í–∞—à API Hash
BOT_TOKEN = "your_bot_token" # –¢–æ–∫–µ–Ω –±–æ—Ç–∞ (–ø–æ–ª—É—á–∏—Ç—å —É @BotFather)
# -------------------------------------------------------------

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏)
user_sessions = {}

# –í–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–∞ (–≤–æ–ø—Ä–æ—Å, –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤, –∏–Ω–¥–µ–∫—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞)
# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0
QUESTIONS = [
    {
        "question": "–°–∫–æ–ª—å–∫–æ –º–µ—Å—è—Ü–µ–≤ –≤ –≥–æ–¥—É –∏–º–µ—é—Ç 28 –¥–Ω–µ–π?",
        "options": ["1", "2", "12", "–í—Å–µ"],
        "correct": 3  # –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: "–í—Å–µ" (–∏–Ω–¥–µ–∫—Å 3)
    },
    {
        "question": "–ß—Ç–æ —Ç—è–∂–µ–ª–µ–µ: –∫–∏–ª–æ–≥—Ä–∞–º–º –≤–∞—Ç—ã –∏–ª–∏ –∫–∏–ª–æ–≥—Ä–∞–º–º –∂–µ–ª–µ–∑–∞?",
        "options": ["–í–∞—Ç–∞", "–ñ–µ–ª–µ–∑–æ", "–û–¥–∏–Ω–∞–∫–æ–≤–æ"],
        "correct": 2  # –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: "–û–¥–∏–Ω–∞–∫–æ–≤–æ" (–∏–Ω–¥–µ–∫—Å 2)
    },
    {
        "question": "–ï—Å–ª–∏ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å —ç—Ç—É —Ü–∏—Ñ—Ä—É, –æ–Ω–∞ —É–º–µ–Ω—å—à–∏—Ç—Å—è –Ω–∞ 3. –ß—Ç–æ —ç—Ç–æ –∑–∞ —Ü–∏—Ñ—Ä–∞?",
        "options": ["6", "8", "9", "3"],
        "correct": 2  # –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: 9 (–∏–Ω–¥–µ–∫—Å 2)
    },
    {
        "question": "–£ —á–µ–ª–æ–≤–µ–∫–∞ –±—ã–ª–æ 10 –æ–≤–µ—Ü. –í—Å–µ, –∫—Ä–æ–º–µ 9, —É–º–µ—Ä–ª–∏. –°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å?",
        "options": ["1", "9", "10", "0"],
        "correct": 1  # –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: 9 (–∏–Ω–¥–µ–∫—Å 1)
    },
    {
        "question": "–ß—Ç–æ –º–æ–∂–Ω–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å, –Ω–æ –Ω–µ–ª—å–∑—è —Å—ä–µ—Å—Ç—å?",
        "options": ["–°—É–ø", "–£—Ä–æ–∫–∏", "–ö–æ—Ñ–µ", "–ó–∞–≤—Ç—Ä–∞–∫"],
        "correct": 1  # –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: "–£—Ä–æ–∫–∏" (–∏–Ω–¥–µ–∫—Å 1)
    }
]

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
bot = Client("iq_test_bot", api_id=API_ID, api_hash=API_HASH, bot_token=BOT_TOKEN)

# –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
async def send_question(chat_id, user_id):
    step = user_sessions[user_id]["step"]
    if step < len(QUESTIONS):
        q = QUESTIONS[step]
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤
        options_text = "\n".join([f"{i+1}. {opt}" for i, opt in enumerate(q["options"])])
        await bot.send_message(
            chat_id,
            f"‚ùì –í–æ–ø—Ä–æ—Å {step+1}/{len(QUESTIONS)}:\n\n"
            f"{q['question']}\n\n{options_text}\n\n"
            f"üìù –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (1-{len(q['options'])})."
        )
    else:
        # –¢–µ—Å—Ç –æ–∫–æ–Ω—á–µ–Ω, –≤—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        score = user_sessions[user_id]["score"]
        total = len(QUESTIONS)
        # –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º—É–ª–∞: –∫–∞–∂–¥—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–∞—ë—Ç +10 –∫ –±–∞–∑–µ 80
        iq = 80 + score * 4  # –¥–∏–∞–ø–∞–∑–æ–Ω: 80..100
        await bot.send_message(
            chat_id,
            f"‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!\n\n"
            f"–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {score} –∏–∑ {total}\n"
            f"üß† –í–∞—à –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π IQ: {iq}\n\n"
            f"–ß—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ, –≤–≤–µ–¥–∏—Ç–µ /iqtest"
        )
        # –û—á–∏—â–∞–µ–º —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        del user_sessions[user_id]

# –ö–æ–º–∞–Ω–¥–∞ /start
@bot.on_message(filters.command("start"))
async def start_cmd(client: Client, message: Message):
    await message.reply(
        "üëã –ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ IQ.\n"
        "–ß—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /iqtest"
    )

# –ö–æ–º–∞–Ω–¥–∞ /iqtest (–Ω–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞)
@bot.on_message(filters.command("iqtest"))
async def iqtest_cmd(client: Client, message: Message):
    user_id = message.from_user.id
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ç–µ—Å—Ç, —Å–ø—Ä–æ—Å–∏–º, —Ö–æ—á–µ—Ç –ª–∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
    if user_id in user_sessions:
        await message.reply("–í—ã —É–∂–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ —Ç–µ—Å—Ç. –•–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ? –û—Ç–ø—Ä–∞–≤—å—Ç–µ /iqtest –µ—â—ë —Ä–∞–∑.")
        return
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏
    user_sessions[user_id] = {"step": 0, "score": 0}
    await send_question(message.chat.id, user_id)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (–Ω–æ–º–µ—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤)
@bot.on_message(filters.text & filters.private & ~filters.command(["start", "iqtest"]))
async def handle_answer(client: Client, message: Message):
    user_id = message.from_user.id
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è
    if user_id not in user_sessions:
        return

    step = user_sessions[user_id]["step"]
    if step >= len(QUESTIONS):
        return  # –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π

    try:
        answer_num = int(message.text.strip())
    except ValueError:
        await message.reply("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ (–Ω–æ–º–µ—Ä –æ—Ç–≤–µ—Ç–∞).")
        return

    q = QUESTIONS[step]
    if 1 <= answer_num <= len(q["options"]):
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏
        if answer_num - 1 == q["correct"]:
            user_sessions[user_id]["score"] += 1
        # –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
        user_sessions[user_id]["step"] += 1
        await send_question(message.chat.id, user_id)
    else:
        await message.reply(f"–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ {len(q['options'])}.")

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
if __name__ == "__main__":
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    bot.run()
